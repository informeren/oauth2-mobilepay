#!/usr/bin/env php
<?php

use Informeren\OAuth2\Client\Provider\MobilePay;

require __DIR__ . '/../vendor/autoload.php';

if ($argc !== 2) {
    print "Usage: accesstoken [authorization code]\n";
    exit(1);
}

$code = $argv[1];

$provider = new MobilePay([
    'clientId' => getenv('CLIENT_ID'),
    'clientSecret' => getenv('CLIENT_SECRET'),
    'discoveryUri' => getenv('DISCOVERY_URI'),
    'redirectUri' => getenv('REDIRECT_URI'),
]);

try {
    $token = $provider->getAccessToken('authorization_code', [
        'code' => $code,
        'code_verifier' => getenv('CODE_VERIFIER'),
    ]);

    print 'Access token: ' . $token->getToken() . "\n";
    print 'Refresh token: ' . $token->getRefreshToken() . "\n";
} catch (Throwable $o_O) {
    print "Unable to retrieve access token!\n";
    exit(1);
}
