#!/usr/bin/env php
<?php

use Informeren\OAuth2\Client\Provider\MobilePay;

require './vendor/autoload.php';

if ($argc > 2) {
    throw new InvalidArgumentException('Usage: accesstoken [authorization code]');
}

$code = $argv[1];

$provider = new MobilePay([
    'clientId' => getenv('CLIENT_ID'),
    'clientSecret' => getenv('CLIENT_SECRET'),
    'codeVerifier' => getenv('CODE_VERIFIER'),
    'merchantVat' => getenv('MERCHANT_VAT'),
    'redirectUri' => getenv('REDIRECT_URI'),
]);

try {
    $token = $provider->getAccessToken('authorization_code', [
        'code' => $code,
    ]);

    print 'Access token: ' . $token->getToken() . "\n";
    print 'Refresh token: ' . $token->getRefreshToken() . "\n";
} catch (Throwable $o_O) {
    print "Unable to retrieve access token!\n";
}
