#!/usr/bin/env php
<?php

use Informeren\OAuth2\Client\Provider\MobilePay;

require __DIR__ . '/../vendor/autoload.php';

if ($argc !== 2) {
    print "Usage: refreshtoken [refresh token]\n";
    exit(1);
}

$refresh_token = $argv[1];

$provider = new MobilePay([
    'clientId' => getenv('CLIENT_ID'),
    'clientSecret' => getenv('CLIENT_SECRET'),
    'discoveryUri' => getenv('DISCOVERY_URI'),
    'redirectUri' => getenv('REDIRECT_URI'),
]);

try {
    $token = $provider->getAccessToken('refresh_token', [
        'refresh_token' => $refresh_token,
    ]);

    print $token->getToken() . "\n";
} catch (Throwable $o_O) {
    print "Unable to refresh access token!\n";
    exit(1);
}
