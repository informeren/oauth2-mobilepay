#!/usr/bin/env php
<?php

use Informeren\OAuth2\Client\Provider\MobilePay;

require __DIR__ . '/../vendor/autoload.php';

$provider = new MobilePay([
    'clientId' => getenv('CLIENT_ID'),
    'clientSecret' => getenv('CLIENT_SECRET'),
    'discoveryUri' => getenv('DISCOVERY_URI'),
    'redirectUri' => getenv('REDIRECT_URI'),
]);

$url = $provider->getAuthorizationUrl([
    'scope' => ['openid', 'subscriptions', 'offline_access'],
    'response_type' => 'code id_token',
    'response_mode' => 'fragment',
    'code_verifier' => getenv('CODE_VERIFIER'),
    'merchant_vat' => getenv('MERCHANT_VAT'),
]);

print "Authorization URL: $url\n";

$command = sprintf('/usr/bin/open "%s"', $url);

exec($command);
